{% extends 'base.html' %}
{% load static %}

{% block title %}اختيار مستلم - محادثة جديدة{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-100 py-12 px-4 sm:px-6 lg:px-8 text-right" dir="rtl">
    <div class="max-w-4xl mx-auto bg-white p-6 md:p-10 rounded-xl shadow-2xl border-t-8 border-blue-600 animate-fade-in-down">
        <div class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-extrabold text-blue-800 mb-3 leading-tight">
                <i class="fas fa-user-plus text-blue-600 ml-3"></i> بدء محادثة جديدة
            </h1>
            <p class="text-gray-600 text-lg md:text-xl max-w-2xl mx-auto">
                اختر من تود التحدث معه من المعلمين أو المسؤولين:
            </p>
        </div>

        {# حقل البحث (اختياري) #}
        <form method="get" class="mb-8">
            <div class="flex items-center space-x-4 space-x-reverse">
                <input type="text" name="q" placeholder="ابحث عن اسم أو بريد إلكتروني..."
                       class="form-input flex-grow p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-lg"
                       value="{{ search_query|default_if_none:'' }}">
                <button type="submit" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-md transition duration-200 ease-in-out">
                    <i class="fas fa-search ml-2"></i> بحث
                </button>
            </div>
        </form>

        {# قسم المعلمين #}
        <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b-2 border-blue-400 pb-2 flex items-center">
            <i class="fas fa-chalkboard-teacher text-blue-500 ml-3"></i> المعلمون
        </h2>
        {% if teachers %}
            <div class="space-y-4 mb-8">
                {% for user in teachers %}
                    <a href="{% url 'messaging:start_or_get_conversation' other_user_id=user.id %}"
                       class="block bg-gray-50 p-4 rounded-lg shadow-sm hover:shadow-md transition duration-200 ease-in-out transform hover:-translate-y-0.5 border-r-4 border-blue-400 hover:border-blue-500 flex items-center justify-between">
                        <div class="flex items-center">
                            <i class="fas fa-user-circle text-blue-500 text-2xl ml-3"></i>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800">{{ user.full_name|default:user.username }}</h3>
                                {% if user.email %}
                                    <p class="text-gray-600 text-sm">{{ user.email }}</p>
                                {% endif %}
                            </div>
                        </div>
                        <i class="fas fa-chevron-left text-gray-400"></i>
                    </a>
                {% endfor %}
            </div>
        {% else %}
            <div class="bg-yellow-50 p-6 rounded-lg shadow-md text-center border-r-4 border-yellow-400 animate-fade-in mb-8">
                <i class="fas fa-info-circle text-yellow-500 text-4xl mb-4"></i>
                <p class="text-gray-700 text-lg">لا يوجد معلمون متاحون حالياً.</p>
            </div>
        {% endif %}

        {# قسم المسؤولين #}
        <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b-2 border-purple-400 pb-2 flex items-center">
            <i class="fas fa-user-shield text-purple-500 ml-3"></i> المسؤولون
        </h2>
        {% if admins %}
            <div class="space-y-4">
                {% for user in admins %}
                    <a href="{% url 'messaging:start_or_get_conversation' other_user_id=user.id %}"
                       class="block bg-gray-50 p-4 rounded-lg shadow-sm hover:shadow-md transition duration-200 ease-in-out transform hover:-translate-y-0.5 border-r-4 border-purple-400 hover:border-purple-500 flex items-center justify-between">
                        <div class="flex items-center">
                            <i class="fas fa-user-cog text-purple-500 text-2xl ml-3"></i>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800">{{ user.full_name|default:user.username }}</h3>
                                {% if user.email %}
                                    <p class="text-gray-600 text-sm">{{ user.email }}</p>
                                {% endif %}
                            </div>
                        </div>
                        <i class="fas fa-chevron-left text-gray-400"></i>
                    </a>
                {% endfor %}
            </div>
        {% else %}
            <div class="bg-yellow-50 p-6 rounded-lg shadow-md text-center border-r-4 border-yellow-400 animate-fade-in">
                <i class="fas fa-info-circle text-yellow-500 text-4xl mb-4"></i>
                <p class="text-gray-700 text-lg">لا يوجد مسؤولون متاحون حالياً.</p>
            </div>
        {% endif %}

    </div>
</div>
{% endblock %}

{% block extra_head %}
<style>
    @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-in-down { animation: fadeInDown 0.7s ease-out forwards; }
    .animate-fade-in { animation: fadeIn 0.8s ease-out forwards; }
    .form-input {
        @apply block px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-lg;
        text-align: right;
        direction: rtl;
    }
</style>
{% endblock %}